<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>YAN_1 – Page 1</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#020617;
  --text:#e5e7eb;
  --border:#334155;
  --accent:#38bdf8;
}

*{box-sizing:border-box}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui, sans-serif;
}

/* TOP BAR */
.topbar{
  position:sticky;
  top:0;
  z-index:10;
  background:rgba(2,6,23,.9);
  backdrop-filter:blur(10px);
  border-bottom:1px solid var(--border);
  padding:.8rem 1rem;
  display:flex;
  gap:.6rem;
  align-items:center;
}

/* SEARCH */
.search-input{
  flex:1;
  padding:.45rem .6rem;
  border-radius:8px;
  border:1px solid var(--border);
  background:#020617;
  color:var(--text);
}
.search-btn,.back-btn,.start-btn,.list-btn{
  padding:.45rem 1rem;
  border-radius:8px;
  font-weight:600;
  cursor:pointer;
  border:none;
}
.search-btn,.start-btn,.list-btn{
  background:var(--accent);
  color:#020617;
}
.back-btn{
  background:#1e293b;
  color:#e5e7eb;
  display:none;
}
.start-btn{margin-left:auto}

/* ITEM */
.item{margin-bottom:3rem}

/* FULL BLEED EMBED */
.embed-wrap{
  position:relative;
  width:100vw;
  margin-left:calc(50% - 50vw);
}
.embed-wrap iframe{
  width:100vw;
  height:420px;
  border:none;
}

/* FULLSCREEN ICON */
.fullscreen{
  position:absolute;
  top:12px;
  right:16px;
  font-size:1.2rem;
  cursor:pointer;
  opacity:.7;
}
.fullscreen:hover{opacity:1}

/* CONTENT */
.content{
  max-width:900px;
  margin:auto;
  padding:1.4rem;
  line-height:1.7;
}
.title{font-size:1.2rem;font-weight:600}
.meta{opacity:.85;margin:.5rem 0}

/* ACTIONS */
.actions{
  display:flex;
  gap:.8rem;
  align-items:center;
}
.open-btn{
  padding:.45rem 1.2rem;
  background:var(--accent);
  color:#020617;
  border-radius:10px;
  font-weight:600;
  cursor:pointer;
}
.share-btn{
  cursor:pointer;
  font-size:1.2rem;
  opacity:.75;
}
.share-btn:hover{opacity:1}

/* LIST OVERLAY */
#listOverlay{
  position:fixed;
  inset:0;
  background:rgba(2,6,23,.97);
  display:none;
  flex-direction:column;
  z-index:9999;
}
#listClose{
  position:absolute;
  top:12px;
  right:16px;
  font-size:1.4rem;
  opacity:.6;
  cursor:pointer;
}
#listClose:hover{opacity:1}
#listContent{
  padding:3rem 1.5rem 2rem;
  overflow-y:auto;
}
.list-item{
  margin-bottom:1.4rem;
}
.list-item a{
  color:var(--accent);
  text-decoration:none;
  font-size:1.05rem;
}

/* PAGE 3 – UNRESTRICTED */
#page3Frame{
  display:block;
  width:100vw;
  min-height:100vh;
  border:none;
}

/* METADATA DISPLAY */
.metadata-section {
  background: rgba(56, 189, 248, 0.1);
  border-radius: 12px;
  padding: 1rem;
  margin: 1rem 0;
}

.metadata-item {
  margin: 0.5rem 0;
}

.metadata-label {
  font-weight: bold;
  color: var(--accent);
}

.metadata-value {
  margin-left: 0.5rem;
}
</style>
</head>

<body>

<!-- TOP BAR -->
<div class="topbar">
  <input id="searchInput" class="search-input" placeholder="Search by title…">
  <button class="search-btn" onclick="search()">Search</button>
  <button class="back-btn" id="backBtn" onclick="resetSearch()">Back</button>
  <button class="start-btn" onclick="openPage2()">Start</button>
  <button class="list-btn" onclick="openList()">List</button>
</div>

<!-- ITEMS -->
<div id="list"></div>

<!-- PAGE 3 (FREE FLOW) -->
<iframe
  id="page3Frame"
  src="page3.html"
  scrolling="yes"
  loading="lazy">
</iframe>

<!-- LIST OVERLAY -->
<div id="listOverlay">
  <span id="listClose" onclick="closeList()">✕</span>
  <div id="listContent"></div>
</div>

<script>
let allData = [];

fetch('data1.json')
  .then(r => r.json())
  .then(data => {
    allData = data;
    render(data);
    buildList(data);
  });

function embed(link){
  if(!link || !link.includes('archive.org')) return '';
  return 'https://archive.org/embed/' + link.split('/details/')[1];
}

async function fetchMetadata(identifier) {
  try {
    const response = await fetch(`https://archive.org/metadata/${identifier}`);
    const data = await response.json();
    return data.metadata || {};
  } catch (error) {
    console.error('Error fetching metadata:', error);
    return {};
  }
}

async function render(items){
  const container = document.getElementById('list');
  container.innerHTML = '';

  for (const item of items) {
    const e = embed(item.archive_link);
    const identifier = item.archive_link.split('/details/')[1];
    const metadata = await fetchMetadata(identifier);
    
    // Extract metadata fields
    const title = metadata.title || 'N/A';
    const description = metadata.description || 'N/A';
    const tags = metadata.subject || [];
    const phone = metadata.phone || 'N/A';
    const email = metadata.email || 'N/A';
    const link1 = metadata.link1 || '#';

    // Format tags
    const formattedTags = Array.isArray(tags) ? tags.join(', ') : tags;

    // Build metadata display
    let metadataHTML = '<div class="metadata-section">';
    
    if (title !== 'N/A') {
      metadataHTML += `<div class="metadata-item"><span class="metadata-label">Title:</span><span class="metadata-value">${title}</span></div>`;
    }
    
    if (description !== 'N/A') {
      metadataHTML += `<div class="metadata-item"><span class="metadata-label">Description:</span><span class="metadata-value">${description}</span></div>`;
    }
    
    if (tags.length > 0 && tags !== 'N/A') {
      metadataHTML += `<div class="metadata-item"><span class="metadata-label">Tags:</span><span class="metadata-value">${formattedTags}</span></div>`;
    }
    
    if (phone !== 'N/A') {
      metadataHTML += `<div class="metadata-item"><span class="metadata-label">Phone:</span><span class="metadata-value">${phone}</span></div>`;
    }
    
    if (email !== 'N/A') {
      metadataHTML += `<div class="metadata-item"><span class="metadata-label">Email:</span><span class="metadata-value">${email}</span></div>`;
    }
    
    metadataHTML += '</div>';

    container.innerHTML += `
      <div class="item">
        ${e ? `
        <div class="embed-wrap">
          <span class="fullscreen" onclick="realFullscreen(this)">⛶</span>
          <iframe src="${e}" loading="lazy"></iframe>
        </div>` : ``}

        <div class="content">
          ${metadataHTML}
          
          <div class="actions">
            <span class="open-btn" onclick="openLink('${link1}')">Open</span>
            <span class="share-btn" onclick="shareLink('${link1}','${title}')">ᯓ➤</span>
          </div>
        </div>
      </div>
    `;
  }
}

/* FULLSCREEN */
function realFullscreen(btn){
  const iframe = btn.nextElementSibling;
  iframe.requestFullscreen?.();
}

/* SEARCH */
function search(){
  const q = searchInput.value.trim().toLowerCase();
  if(!q) return;
  render(allData.filter(i=>i.title?.toLowerCase().includes(q)));
  backBtn.style.display='inline-block';
}
function resetSearch(){
  searchInput.value='';
  backBtn.style.display='none';
  render(allData);
}

/* LINKS */
function openLink(url){
  window.open(url,'_blank');
}

/* PAGE2 */
function openPage2(){
  location.href='page2.html';
}

/* LIST */
function buildList(data){
  listContent.innerHTML='';
  data.forEach(i=>{
    listContent.innerHTML+=`
      <div class="list-item">
        <div>${i.title}</div>
        <a href="${i.link1}" target="_blank">${i.link1}</a>
      </div>
    `;
  });
}
function openList(){ listOverlay.style.display='flex'; }
function closeList(){ listOverlay.style.display='none'; }

/* ESC */
document.addEventListener('keydown',e=>{
  if(e.key==='Escape'){
    closeList();
    document.fullscreenElement && document.exitFullscreen();
  }
});
</script>

</body>
</html>
